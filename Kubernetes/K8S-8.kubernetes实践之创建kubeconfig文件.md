## kubernetes实践-创建kubeconfig相关文件
- 需要说明的是 kubelet、kube-proxy 等 Node 机器上的进程与 Master 机器的 kube-apiserver 进程通信时需要认证和授权；
- kubernetes v1.4 版本开始支持由 kube-apiserver 为客户端生成 TLS 证书的 TLS Bootstrapping功能，这样就不需要为每个客户端生成证书了，但目前只支持为 kubectl 生成证书。
> 以下操作只需要在 `master` 上执行即可，生成的 `*.kubeconfig` 文件可以直接拷贝到node节点的 `/etc/kubernetes` 目录下。

### 创建 TLS Bootstrapping Token
- token 可以是任意的包涵128 bit的字符串，可以使用安全的随机数发生器生成。
- 具体配置参考如下：
  ``` bash
  cd /etc/kubernetes
  export BOOTSTRAP_TOKEN=$(head -c 16 /dev/urandom | od -An -t x | tr -d ' ')
  
  cat > token.csv <<EOF
  ${BOOTSTRAP_TOKEN},kubelet-bootstrap,10001,"system:kubelet-bootstrap"
  EOF
  ```
> 需要注意的是在进行后续操作前请检查 token.csv 文件，确认其中的 ${BOOTSTRAP_TOKEN} 环境变量已经被真实的值替换。
- BOOTSTRAP_TOKEN 将被写入到 kube-apiserver 使用的 token.csv 文件和 kubelet 使用的 bootstrap.kubeconfig 文件，如果后续重新生成了 BOOTSTRAP_TOKEN，则需要进行如下操作：
  * 1.更新 `token.csv` 文件，分发到所有机器 (master 和 node）的 `/etc/kubernetes/` 目录下，分发到node节点上非必需；
  * 2.重新生成 `bootstrap.kubeconfig` 文件，分发到所有 node 机器的 `/etc/kubernetes/` 目录下；
  * 3.重启 `kube-apiserver` 和 `kubelet` 进程；
  * 4.重新 approve kubelet 的 csr 请求。


  

